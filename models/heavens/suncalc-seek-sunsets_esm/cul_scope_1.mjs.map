{"version":3,"names":["addMinutes","isSameDay","addDays","_","sunset_date","sunset_date_in","duration_factor","duration_factor_in","sunset_projection_times_for_sunset_date","lat_in","lng_in","l_in","b_in","lat","lng","l","b","Date","range","map","i","sunset_time_for_sunset_date","sunset_projection_for_sunset_date","date_in","altitude","altitude_obj","obj_in","azimuth","azimuth_obj","find","d","date","dayMs","J1970","J2000","rad","Math","PI","sin","cos","tan","asin","atan","atan2","acos","e","lw","phi","julian_1","valueOf","right_ascension","declination","dec","dec_in","H","sidereal_time","obj","solar_mean_anomaly","console","error","equation_of_center","perihelion_of_earth","ecliptic_longitude","declination_L0","right_ascension_L0"],"sources":["suncalc-seek-sunsets.cul.js"],"sourcesContent":["// TERRIBLE\n// Seeking approach (note recursion) will be hopeless without memo\n// Until [issue #72](https://github.com/calculang/calculang/issues/72) is fixed,\n// this means I can't use modularity.\n// Therefore I copy the suncalc.cul code below.\n\n// other terrible things: This exposed some other bugs in calculang.\n// So this seeking part is **not** a good example of clean, recyclable, model code, which is what calculang models should be.\n\nimport { addMinutes, isSameDay, addDays } from 'date-fns';\nimport _ from 'underscore';\n\nexport const sunset_date = () => sunset_date_in;\n\n// seeking: we can use the sunset time in previous day to give us a rough idea of the sunset time in the following day.\n// This just about works for my viz purposes.\n\nexport const duration_factor = () => (duration_factor_in);\n\nexport const sunset_projection_times_for_sunset_date = () => {\n  //date(); obj_in();\n  //sunset_time_for_sunset_date({ sunset_date_in: new Date(2021, 9, 29) });\n  lat();\n  lng();\n  l();\n  duration_factor();\n  b(); //very bad hack around calculang bugs in this fn\n  if (isSameDay(sunset_date(), new Date(2021, 9, 29))) // start date is calculang release date\n    return _.range(0, 200) // ~~500 mins => over 8 hours~~\n      .map((i) => addMinutes(new Date(2021, 9, 29, 12 /* 5pm? */), i * 5)); // these are very limiting paramaters for other locations ! Maybe move to check all 5 min intervals?\n  // assuming after 10/29/21\n  else\n    return _.range(-duration_factor(), 15) // ~75mins. Wide to capture time changes? +I could use the solsticies to avoid seeking both ways\n      .map((i) =>\n        addDays(\n        addMinutes(\n          sunset_time_for_sunset_date(\n            { sunset_date_in: addDays(sunset_date(), -1) },\n            0 // hack somehow?\n          ),\n          i * 5\n        ), 1)\n      );\n\n  //.map((datezz) => (\n  /*altitude:*/ 6; //altitude_obj({ obj_in: 'sun', X: date()*0+obj() }) // compiler doesn't like this\n  //,azimuth: 2//azimuth_obj({ /* obj_in: 'sun', date_in, X: date()*0+obj() */ }),\n  //));\n};\n\nexport const sunset_projection_for_sunset_date = () =>\n  sunset_projection_times_for_sunset_date().map((date_in) => ({\n    date_in,\n    sunset_date_in: sunset_date(),\n    altitude: altitude_obj({ obj_in: 'sun' }),\n    azimuth: azimuth_obj({ obj_in: 'sun' }),\n  }));\n\nexport const sunset_time_for_sunset_date = () =>\n  sunset_projection_for_sunset_date().find((d) => d.altitude < 0).date_in;\n\n\n////// suncalc.cul.js begin:\n\n// based on formulae in SunCalc,\n// https://github.com/mourner/suncalc\n// SunCalc is (c) Vladimir Agafonkin (http://agafonkin.com/en)\n\n// SunCalc readme:\n// \"Most calculations are based on the formulas given in the excellent Astronomy Answers articles\n// about [position of the sun](http://aa.quae.nl/en/reken/zonpositie.html)\n// and [the planets](http://aa.quae.nl/en/reken/hemelpositie.html).\"\n\n// ideas: compare/rec against Mike Bostock solar-calculator module on npm, and/or NOAA s/s on which solar-calculator based.\n// + https://observablehq.com/@mourner/sun-position-in-900-bytes\n//   ^ \"more precise\" \"based on formulas from the 2nd edition of [Jean Meeus's \"Astronomical Algorithms\" book](https://www.willbell.com/math/mc1.htm)\" \n\n// + https://observablehq.com/@mourner/sun-position-in-900-bytes\n// \"based on formulas from the 2nd edition of [Jean Meeus's \"Astronomical Algorithms\" book](https://www.willbell.com/math/mc1.htm)\" \"more precise\"\n\nexport const date = () => date_in;\nexport const lat = () => lat_in;\nexport const lng = () => lng_in;\n\n// \"date/time constants and conversions\"\nexport const dayMs = () => 1000 * 60 * 60 * 24;\nexport const J1970 = () => 2440588;\nexport const J2000 = () => 2451545;\nexport const rad = () => Math.PI / 180;\n\n// bad form?\nvar PI = Math.PI,\n  sin = Math.sin,\n  cos = Math.cos,\n  tan = Math.tan,\n  asin = Math.asin,\n  atan = Math.atan2,\n  acos = Math.acos;\n\nexport const e = () => rad() * 23.4397; // obliquity of the Earth\n\nexport const lw = () => rad() * -lng();\nexport const phi = () => rad() * lat();\n\nexport const julian_1 = () => date().valueOf() / dayMs() - 0.5 + J1970() - J2000(); // fn on date_in\n\n//// right_ascension, declination locked input structure\nexport const l = () => l_in;\nexport const b = () => b_in;\n\nexport const right_ascension = () =>\n  atan(sin(l()) * cos(e()) - tan(b()) * sin(e()), cos(l()));\nexport const declination = () =>\n  asin(sin(b()) * cos(e()) + cos(b()) * sin(e()) * sin(l()));\n\n/// azimuth, altitude ~~locked~~ input structure\n//export const H = () => H_in;\n//export const phi = () => phi_in;\nexport const dec = () => dec_in;\n\nexport const azimuth = () =>\n  atan(sin(H()), cos(H()) * sin(phi()) - tan(dec()) * cos(phi())); // some refactors to function might help here\nexport const altitude = () =>\n  asin(sin(phi()) * sin(dec()) + cos(phi()) * cos(dec()) * cos(H()));\n\n//export const lw = () => lw_in;\nexport const sidereal_time = () =>\n  rad() * (280.16 + 360.9856235 * julian_1()) - lw();\n\n// abstract sun, moon values via obj_in\nexport const obj = () => obj_in;\nexport const solar_mean_anomaly = () => {\n  if (obj() == 'sun') return rad() * (357.5291 + 0.98560028 * julian_1());\n  else if (obj() == 'moon') return rad() * (134.963 + 13.064993 * julian_1());\n  else console.error('obj not sun or moon');\n};\n\nexport const equation_of_center = () =>\n  rad() *\n  (1.9148 * sin(solar_mean_anomaly()) +\n    0.02 * sin(2 * solar_mean_anomaly()) +\n    0.0003 * sin(3 * solar_mean_anomaly()));\n\nexport const perihelion_of_earth = () => rad() * 102.9372;\n\nexport const ecliptic_longitude = () =>\n  Math.PI + solar_mean_anomaly() + equation_of_center() + perihelion_of_earth();\n\n// sunCoords outputs (still intermediate)\n// naming convention? (L, 0) / _obj?\nexport const declination_L0 = () =>\n  declination({ l_in: ecliptic_longitude(), b_in: 0 });\nexport const right_ascension_L0 = () =>\n  right_ascension({ l_in: ecliptic_longitude(), b_in: 0 });\n\nexport const H = () => sidereal_time() - right_ascension_L0();\n\n// outputs\nexport const azimuth_obj = () => azimuth({ dec_in: declination_L0() });\nexport const altitude_obj = () => altitude({ dec_in: declination_L0() });\n\n// moon calcs in suncalc have an astroRefraction param I didn't build?\n// also some other error?\n// but sun recs closer from a few tests\n"],"mappings":"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"}